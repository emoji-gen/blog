Title: Pelican + Firebase Hosting で始める開発ブログ
Date: 2018-11-09 10:00
Modified: 2018-11-09 10:00
Slug: ignited

<img src="{static}/images/20181109/thumbnail.png" width="300" height="130" class="thumbnail">

みなさんこんにちは。いつも <a href="https://emoji-gen.ninja" rel="bookmark">絵文字ジェネレーター</a> をご利用いただき、ありがとうございます！絵文字ジェネレーターの開発者です。

このたび、絵文字ジェネレーターのアップデートの告知、技術情報の発信を目的として、開発者ブログを立ち上げることになりました。このブログを通して、絵文字ジェネレーターのことをよりよく知っていただけると幸いです。どうぞ、よろしくお願いします。

はじめの記事は、この開発者ブログ自体の技術的な話となります。
この開発者ブログは WordPress などの CMS 等は用いず、Python 製の静的サイトジェネレーター <a href="https://github.com/getpelican/pelican" target="_blank" rel="noopener">Pelican</a> を用いて構築しています。記事は Markdown で記述し、生成された HTML は <a href="https://firebase.google.com/docs/hosting/?hl=ja" target="_blank" rel="noopener">Firebase Hosting</a> を用いてホスティングしています。

この記事では、技術選定の理由や、全体の構成、Pelican のテーマの作成方法までを順に説明していけたらと思います。

<!-- PELICAN_END_SUMMARY -->

## ブログの全体構成
この開発ブログは、静的サイトジェネレーターである Pelican をメインに、以下のような技術で構成されています。

TODO: 図

静的サイトジェネレーターは、Ruby 製の <a href="https://jekyllrb.com/" target="_blank" rel="noopener">Jekyll</a>、Go 製の <a href="https://gohugo.io/" target="_blank" rel="noopener">HUGO</a>、JavaScript 製の <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> などが有名かなと思いますが、今回は Python 製の <a href="https://github.com/getpelican/pelican" target="_blank" rel="noopener">Pelican</a> を選択しました。

<a href="https://emoji-gen.ninja" rel="bookmark">絵文字ジェネレーター</a> は、ウェブサイト本体と周辺ツールがほぼ全て Python によって開発されており、開発言語を合わせたかったのが選択の理由です。事実、Pelican は普段 Python でウェブサービスを作っている人にとって、非常に使いやすいツールでした。

プロダクションで配信している HTML ファイルは、CircleCI 上でビルドし、<a href="https://firebase.google.com/docs/hosting/?hl=ja" target="_blank" rel="noopener">Firebase Hosting</a> でホスティングしています。Firebase は、CLI ツール群が CI と連携することを念頭に置いて設計されているため、CI との相性は抜群でした。

最終的には Firebase Hosting 上の HTML ファイルは <a href="https://aws.amazon.com/jp/cloudfront/" target="_blank" rel="noopener">CloudFront</a> を経由し配信されます。絵文字ジェネレーターのドメイン emoji-gen.ninja は、全体が CloudFront を経由する設計になっています。このブログはサブディレクトリで運用したかったため、必然としてその経路にする必要がありました。

## Pelican とは?
<a href="https://github.com/getpelican/pelican" target="_blank" rel="noopener">Pelican</a> は Python 製の静的サイトジェネレーターで、Python 2.7 もしくは 3.4 以降で動作します。<a href="http://docs.getpelican.com/en/stable/" target="_blank" rel="noopener">公式ドキュメント</a> が案外充実しており、使い方・設定項目・テンプレートの作成方法などが解説されています。よほど凝ったことをしなければ、公式ドキュメントを読むだけで問題なく利用できます。

記事は reStructuredText か Markdown かどちらかで記述できます。このブログでは Markdown を使っています。記事は固定記事 (ページ) と投稿 (時系列の記事) のどちらかになります。記事の URL やディレクトリ構成が、簡単にカスタマイズできるのは良い点です。

記事は最終的に HTML に変換され、テーマのテンプレートエンジンを通して最終的な HTML が出力されます。テーマのテンプレートエンジンには <a href="http://jinja.pocoo.org/" target="_blank" rel="noopener">Jinja2</a> が採用されています。Jinja2 のカスタムフィルタが設定できるので、やりたいことはだいたい何でもできます。このブログでは、独自のテーマを作成して、それを利用しています。

## Pelican のテーマ作成
Pelican は <a href="http://docs.getpelican.com/en/stable/themes.html">公式ドキュメント</a> が充実しているので、テーマを作る際はまずそこに目を通すことをおすすめします。

### テンプレート構成
トップページ (記事一覧)、記事のページ、タグ一覧のページなど、ページごとに呼ばれるテンプレートが決まっており、作成したいページのテンプレートはすべて作成する必要があります。設定で特定のテンプレートを無効化することができるので、必要がないページは無効化しておくと、テンプレートの開発が楽になります。

このブログでは、本来 11 ページ分のテンプレートが必要な所、記事一覧と記事詳細の 2 ページ分のみのテンプレートで済ませています。汎用的なテーマを作るのでなければ、必要になったら作る運用で十分です。

固定ページを多様するような使い方をする場合、記事ごとにテンプレートを設定することもできるので、その手法を取るとカスタマイズの幅が広がり便利です。このブログは、固定ページは絵文字ジェネレーター本体側へ移譲するため、使ってません。

### CSS (スタイル) の作成
テーマの CSS は Webpack を用いてビルドしています。Pelican の <a href="https://github.com/getpelican/pelican-plugins/tree/master/assets" target="_blank" rel="noopener">assets プラグイン</a> を使うと、SASS を直接ビルドし minify することも可能なのですが、正直いつも使い慣れている Webpack を直接叩いた方が痒い所に手が届きます。

Pelican には、PC 版とスマフォ版で HTML を出力仕分けるという機能はありません (仮に分けれたとしても、配信側での対応が必要ですが...)。そのため、複数の画面サイズに最適化したデザインにしたいのであれば、同一の HTML に対してメディアクエリで分岐する手法を取ります。

テーマで使っている画像や CSS などの静的ファイルは、規定のディレクトリに配置しておくと、勝手に出力ディレクトリへコピーされます。

### 構造化データ対応
このブログでは JSON-LD 形式で構造化データを埋め込んでいます。

```html
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "name": "{{ AUTHOR }}",
    "sameAs": [
      "https://twitter.com/emoji_gen"
    ],
    "logo": {
      "@type": "ImageObject",
      "height": 512,
      "url": "{{ SITEURL }}/{{ THEME_STATIC_DIR }}/images/logo-512.png",
      "width": 512
    },
    "url": "https://emoji-gen.ninja/"
  }
</script>
```

### パフォーマンスチューニング
ああああ
## その他 Pelican の開発 Tips
### プラグインの活用
### AMP 対応

## Firebase Hosting とは?
## Firebase Hosting の開発 Tips

https://github.com/emoji-gen/blog
